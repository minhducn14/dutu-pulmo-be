{
  "name": "ChatBotTuVan",
  "nodes": [
    {
      "parameters": {
        "public": true,
        "initialMessages": "Xin ch√†o! T√¥i l√† tr·ª£ l√Ω AI t∆∞ v·∫•n s·ª©c kh·ªèe h√¥ h·∫•p. T√¥i c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n h√¥m nay? ü´Å",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [
        832,
        2080
      ],
      "id": "0fb02c50-7244-403e-b32b-da7c38434f45",
      "name": "When chat message received",
      "webhookId": "331f2a19-5822-4a7d-9146-5cde9bb62ee8"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "chat",
        "responseMode": "responseNode",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          }
        }
      },
      "id": "ed1c8ca6-91d5-4907-9946-63a898cfe371",
      "name": "Webhook (API)",
      "type": "n8n-nodes-base.webhook",
      "position": [
        832,
        2256
      ],
      "webhookId": "b99f7a17-c9f1-47df-9517-785ac56d3b33",
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\nfor (const item of items) {\n  const rawInput = item.json.chatInput || item.json.body?.message || item.json.body?.query || '';\n  const sessionId = item.json.sessionId || item.json.body?.sessionId || `session-${Date.now()}`;\n\n  item.json = {\n    chatInput: rawInput,\n    sessionId: sessionId,\n    source: item.json.chatInput ? 'chat' : 'api',\n    receivedAt: new Date().toISOString()\n  };\n}\n\nreturn items;"
      },
      "id": "47f40d14-13c4-4170-8bd5-a8bc2f5bd290",
      "name": "Normalize Input",
      "type": "n8n-nodes-base.code",
      "position": [
        1088,
        2176
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.chatInput }}",
        "options": {
          "systemMessage": "You are an AI assistant and expert specializing in **Respiratory Health and Pulmonology (Lung Health)**.\nYour role is to provide user-friendly, medically relevant answers **based entirely on information gathered from the provided Vector Database context**.\n\n‚ö†Ô∏è **CORE RULES:**\n1. **SOURCE OF TRUTH:** Use ONLY verified data from the collected context (Vector Database). Do not speculate, hallucinate, or use outside knowledge.\n2. **NO DIAGNOSIS/PRESCRIPTION:** NEVER diagnose specific conditions (e.g., Pneumonia, COPD) or prescribe medications (e.g., antibiotics, specific dosage).\n3. **EMERGENCY PROTOCOL (PRIORITY):** If the user describes **severe symptoms** (gasping for air, blue lips/fingertips, coughing up significant blood, severe chest pain), **IMMEDIATELY advise them to seek emergency medical attention or go to the nearest hospital.**\n\nüó£Ô∏è **TONE & STYLE:**\n- ‚úÖ Clear, simple, and informative.\n- üßë‚Äç‚öïÔ∏è Friendly, empathetic, and calming (acknowledge that breathing issues cause anxiety).\n- ‚ùå Avoid overly clinical jargon; explain terms simply.\n\nüìù **RESPONSE FORMAT:**\nIf vector data is available, structure your response as follows:\n- **Bullet points with emojis:**\n    - üìå Common causes: [Information from context]\n    - üíä Symptoms may include: [Information from context, e.g., cough, wheezing, sputum]\n    - ‚ö†Ô∏è Note/Red Flags: [Safety warnings from context]\n    - üõ°Ô∏è General advice: [Wellness/Hygiene tips from context]\n\n‚ùì **ENGAGEMENT (Follow-up):**\nAfter answering, gently ask 1‚Äì2 open-ended questions to gather context. Use a caring tone:\n- \"Have you experienced this shortness of breath specifically when lying down or exercising?\"\n- \"Can you share how long you've had this cough?\"\n- \"Does anything make your breathing feel better or worse?\"\n\nüìâ **MISSING DATA HANDLING:**\nIf the Vector Database does not contain the answer:\nReply politely: **\"I do not have enough information in my database to answer this specific question. Please consider consulting a medical professional for accurate advice.\"**\n\nüë®‚Äç‚öïÔ∏è **APPOINTMENT & CLOSING:**\nWhen appropriate (or if asked about booking):\n\"To make an appointment, you can:\n**Contact [T√™n B√°c sƒ©/Ph√≤ng kh√°m], Specialist in Pulmonology - Respiratory.**\n**Zalo/Hotline: [S·ªë ƒëi·ªán tho·∫°i/Li√™n h·ªá]**\n*Please have information about your symptoms ready (e.g., duration, sputum color) to help the doctor.*\"\n\n‚úÖ **MANDATORY FOOTER:**\nAlways end every response with:\n\"T√¥i l√† tr·ª£ l√Ω AI. ƒê·ªÉ ƒë∆∞·ª£c t∆∞ v·∫•n chuy√™n m√¥n, vui l√≤ng li√™n h·ªá v·ªõi b√°c sƒ©.\"\n\nüåê **LANGUAGE:**\n**ALWAYS reply in Vietnamese.**\n"
        }
      },
      "id": "55e08ab6-ca1a-4cf1-9b78-fca17a0bbc99",
      "name": "AI Agent (RAG)",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        1568,
        2192
      ],
      "typeVersion": 1.9
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "e1847f9b-5247-4575-9ede-0487b3f2429a",
      "name": "Google Gemini Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "position": [
        1472,
        2480
      ],
      "typeVersion": 1,
      "credentials": {
        "googlePalmApi": {
          "id": "QWdaC79EGk4Urrq9",
          "name": "Testn8nrag"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.sessionId }}"
      },
      "id": "8cffd275-1d01-4773-862d-34da361f5430",
      "name": "Conversation Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "position": [
        1664,
        2480
      ],
      "typeVersion": 1.3
    },
    {
      "parameters": {
        "name": "Respiratory_Knowledge_Base",
        "description": "Vector database containing respiratory health information, common conditions, symptoms, and general medical advice",
        "topK": 5
      },
      "id": "630e2c3b-89d1-42c4-b0b9-f76a4034dd2c",
      "name": "Knowledge Base Tool",
      "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
      "position": [
        1792,
        2544
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "pineconeIndex": {
          "__rl": true,
          "value": "dulturagver1",
          "mode": "list",
          "cachedResultName": "dulturagver1"
        },
        "options": {}
      },
      "id": "4c43bc52-beda-4cbb-bccb-2e780cf41cf4",
      "name": "Pinecone Vector Store",
      "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
      "position": [
        1664,
        2704
      ],
      "typeVersion": 1.1,
      "credentials": {
        "pineconeApi": {
          "id": "Q66qviX7pKvEE4Ri",
          "name": "PineconeApi account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "53ebadae-ee56-446b-9d68-36caf22f7df2",
      "name": "Gemini Chat for Embeddings",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "position": [
        2064,
        2768
      ],
      "typeVersion": 1,
      "credentials": {
        "googlePalmApi": {
          "id": "QWdaC79EGk4Urrq9",
          "name": "Testn8nrag"
        }
      }
    },
    {
      "parameters": {},
      "id": "155276b8-e38e-4626-a188-3b10e7eaadb8",
      "name": "Google Gemini Embeddings",
      "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
      "position": [
        1760,
        2864
      ],
      "typeVersion": 1,
      "credentials": {
        "googlePalmApi": {
          "id": "d0L2ixZzS1iPzIRF",
          "name": "N8N"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "success-condition",
              "operator": {
                "type": "string",
                "operation": "notEmpty"
              },
              "leftValue": "={{ $json.output }}",
              "rightValue": ""
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "bdb298f2-fa45-46a3-90c2-d2c6c03f87ad",
      "name": "Check AI Success",
      "type": "n8n-nodes-base.if",
      "position": [
        1872,
        2320
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "success-response",
              "name": "response",
              "type": "string",
              "value": "={{ $json.output }}"
            },
            {
              "id": "severity",
              "name": "severity",
              "type": "string",
              "value": "normal"
            }
          ]
        },
        "options": {}
      },
      "id": "e5099d91-b011-4f41-95d2-3c31a44903e5",
      "name": "Format Success Response",
      "type": "n8n-nodes-base.set",
      "position": [
        2304,
        2192
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "error-response",
              "name": "response",
              "type": "string",
              "value": "Xin l·ªói, ƒë√£ x·∫£y ra l·ªói khi x·ª≠ l√Ω c√¢u h·ªèi c·ªßa b·∫°n. Vui l√≤ng th·ª≠ l·∫°i sau ho·∫∑c li√™n h·ªá v·ªõi b√°c sƒ© tr·ª±c ti·∫øp ƒë·ªÉ ƒë∆∞·ª£c t∆∞ v·∫•n.\n\nüìû H·ªó tr·ª£: [S·ªë ƒëi·ªán tho·∫°i ph√≤ng kh√°m]\nüíô S·ª©c kh·ªèe c·ªßa b·∫°n l√† ∆∞u ti√™n h√†ng ƒë·∫ßu c·ªßa ch√∫ng t√¥i."
            },
            {
              "id": "error-type",
              "name": "responseType",
              "type": "string",
              "value": "error"
            },
            {
              "id": "error-severity",
              "name": "severity",
              "type": "string",
              "value": "low"
            }
          ]
        },
        "options": {}
      },
      "id": "a3c47925-40bf-41ee-b56b-cc5eaabca77f",
      "name": "Format Error Response",
      "type": "n8n-nodes-base.set",
      "position": [
        2064,
        2416
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "jsCode": "const item = $input.first();\nconst data = item?.json || {};\n\n// sessionId: ∆∞u ti√™n l·∫•y t·ª´ item hi·ªán t·∫°i, fallback v·ªÅ Normalize Input\nlet sessionId = data.sessionId;\ntry {\n  if (!sessionId) sessionId = $('Normalize Input').item.json.sessionId;\n} catch (e) {\n  // ignore\n}\n\nconst response = data.response || 'Xin l·ªói, t√¥i kh√¥ng hi·ªÉu c√¢u h·ªèi c·ªßa b·∫°n.';\nconst responseType = data.responseType || 'general';\nconst severity = data.severity || 'normal';\n\nconst finalResponse = {\n  success: true,\n  data: {\n    message: response,\n    type: responseType,\n    severity,\n    timestamp: new Date().toISOString(),\n    disclaimer: responseType === 'emergency'\n      ? null\n      : 'üíô Th√¥ng tin n√†y ch·ªâ mang t√≠nh tham kh·∫£o. Vui l√≤ng tham kh·∫£o b√°c sƒ© ƒë·ªÉ ƒë∆∞·ª£c t∆∞ v·∫•n ch√≠nh x√°c.',\n    suggestedActions: responseType === 'emergency'\n      ? [\n          'G·ªçi c·∫•p c·ª©u 115 ngay l·∫≠p t·ª©c',\n          'ƒê·∫øn b·ªánh vi·ªán/ph√≤ng c·∫•p c·ª©u g·∫ßn nh·∫•t',\n          'Gi·ªØ b√¨nh tƒ©nh v√† ng·ªìi th·∫≥ng'\n        ]\n      : responseType === 'medication_question'\n      ? [\n          'Tham kh·∫£o d∆∞·ª£c sƒ© tr∆∞·ªõc khi d√πng thu·ªëc',\n          'ƒê·ªçc k·ªπ h∆∞·ªõng d·∫´n s·ª≠ d·ª•ng',\n          'Theo d√µi ph·∫£n ·ª©ng c·ªßa c∆° th·ªÉ'\n        ]\n      : [\n          'Theo d√µi tri·ªáu ch·ª©ng trong v√†i ng√†y',\n          'G·∫∑p b√°c sƒ© n·∫øu kh√¥ng thuy√™n gi·∫£m',\n          'Gi·ªØ v·ªá sinh v√† ngh·ªâ ng∆°i ƒë·∫ßy ƒë·ªß'\n        ]\n  },\n  meta: {\n    sessionId: sessionId || 'unknown',\n    queryType: responseType,\n    processedAt: new Date().toISOString()\n  }\n};\n\nreturn [{ json: finalResponse }];"
      },
      "id": "3c0b21d0-c012-491f-aad2-912bb4f70dfd",
      "name": "Compile Final Response",
      "type": "n8n-nodes-base.code",
      "position": [
        3200,
        2240
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify($json, null, 2) }}",
        "options": {
          "responseCode": 200,
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "application/json; charset=utf-8"
              },
              {
                "name": "X-Health-Disclaimer",
                "value": "This is not medical advice. Consult a doctor."
              },
              {
                "name": "X-Response-Time",
                "value": "={{ new Date().toISOString() }}"
              }
            ]
          }
        }
      },
      "id": "347b3b18-6ad5-43e4-adae-ec0819553129",
      "name": "Send Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "position": [
        3456,
        2064
      ],
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "kb-check",
              "leftValue": "={{ $json.output }}",
              "rightValue": "kh√¥ng c√≥ ƒë·ªß th√¥ng tin",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            },
            {
              "id": "kb-check-2",
              "leftValue": "={{ $json.output }}",
              "rightValue": "kh√¥ng t√¨m th·∫•y",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            },
            {
              "id": "kb-check-3",
              "leftValue": "={{ $json.output }}",
              "rightValue": "database",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "id": "96b51e66-aeeb-494d-bd53-a6030dd390e6",
      "name": "Check KB Has Data?",
      "type": "n8n-nodes-base.if",
      "position": [
        2112,
        1936
      ],
      "typeVersion": 2.3,
      "notes": "TH√äM NODE M·ªöI: Ki·ªÉm tra xem KB c√≥ tr·∫£ l·ªùi ƒë∆∞·ª£c kh√¥ng"
    },
    {
      "parameters": {
        "jsCode": "// Prepare for Gemini (n8n Code node)\n// Output: { question, sessionId, needsFallback }\n\nconst items = $input.all();\n\nfunction safeGetFromNormalizeInput() {\n  try {\n    const ni = $('Normalize Input').first()?.json;\n    if (!ni) return null;\n    return {\n      question: ni.chatInput || '',\n      sessionId: ni.sessionId || '',\n    };\n  } catch (e) {\n    return null;\n  }\n}\n\nconst fromNI = safeGetFromNormalizeInput();\n\nreturn items.map((item) => {\n  const j = item.json || {};\n\n  const question =\n    (fromNI?.question && fromNI.question.trim()) ||\n    (j.chatInput && String(j.chatInput).trim()) ||\n    (j.question && String(j.question).trim()) ||\n    (j.body?.message && String(j.body.message).trim()) ||\n    (j.body?.query && String(j.body.query).trim()) ||\n    (j.output && String(j.output).trim()) || // n·∫øu c·∫ßn debug th√¨ l·∫•y t·∫°m\n    '';\n\n  const sessionId =\n    (fromNI?.sessionId && fromNI.sessionId.trim()) ||\n    (j.sessionId && String(j.sessionId).trim()) ||\n    (j.body?.sessionId && String(j.body.sessionId).trim()) ||\n    `session-${Date.now()}`;\n\n  return {\n    json: {\n      chatInput: question,\n      sessionId,\n      needsFallback: true,\n    },\n  };\n});\n"
      },
      "id": "3d9773a8-e212-4a18-9ee8-4219a50e4b11",
      "name": "Prepare for Gemini",
      "type": "n8n-nodes-base.code",
      "position": [
        2352,
        1776
      ],
      "typeVersion": 2,
      "notes": "TH√äM NODE M·ªöI: Chu·∫©n b·ªã c√¢u h·ªèi cho Gemini"
    },
    {
      "parameters": {
        "messages": {
          "messageValues": [
            {
              "message": "You are an AI assistant and expert specializing in **Respiratory Health and Pulmonology (Lung Health)**. Your role is to provide user-friendly, medically relevant answers.  ‚ö†Ô∏è **CORE RULES:** 1. **NO DIAGNOSIS/PRESCRIPTION:** NEVER diagnose specific conditions (e.g., Pneumonia, COPD) or prescribe medications (e.g., antibiotics, specific dosage). 2. **EMERGENCY PROTOCOL (PRIORITY):** If the user describes **severe symptoms** (gasping for air, blue lips/fingertips, coughing up significant blood, severe chest pain), **IMMEDIATELY advise them to seek emergency medical attention or go to the nearest hospital.**  üó£Ô∏è **TONE & STYLE:** - ‚úÖ Clear, simple, and informative. - üßë‚Äç‚öïÔ∏è Friendly, empathetic, and calming (acknowledge that breathing issues cause anxiety). - ‚ùå Avoid overly clinical jargon; explain terms simply.  üìù **RESPONSE FORMAT:** If vector data is available, structure your response as follows: - **Bullet points with emojis:**     - üìå Common causes: [Information from context]     - üíä Symptoms may include: [Information from context, e.g., cough, wheezing, sputum]     - ‚ö†Ô∏è Note/Red Flags: [Safety warnings from context]     - üõ°Ô∏è General advice: [Wellness/Hygiene tips from context]  ‚ùì **ENGAGEMENT (Follow-up):** After answering, gently ask 1‚Äì2 open-ended questions to gather context. Use a caring tone: - \"Have you experienced this shortness of breath specifically when lying down or exercising?\" - \"Can you share how long you've had this cough?\" - \"Does anything make your breathing feel better or worse?\"  üìâ **MISSING DATA HANDLING:** If the does not the answer: Reply politely: **\"I do not have enough information in my database to answer this specific question. Please consider consulting a medical professional for accurate advice.\"**  ‚úÖ **MANDATORY FOOTER:** Always end every response with: \"T√¥i l√† tr·ª£ l√Ω AI. ƒê·ªÉ ƒë∆∞·ª£c t∆∞ v·∫•n chuy√™n m√¥n, vui l√≤ng li√™n h·ªá v·ªõi b√°c sƒ©.\"  üåê **LANGUAGE:** **ALWAYS reply in Vietnamese.**"
            }
          ]
        },
        "batching": {}
      },
      "id": "eb71c2be-67fb-4359-9751-5e6fe0dbdd5b",
      "name": "Gemini Fallback Answer",
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "position": [
        2624,
        1648
      ],
      "typeVersion": 1.9,
      "notes": "TH√äM NODE M·ªöI: Gemini tr·∫£ l·ªùi khi KB kh√¥ng c√≥ data"
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "498d4821-cef0-4d77-95de-c23fadb65e57",
      "name": "Gemini Fallback Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "position": [
        2576,
        1840
      ],
      "typeVersion": 1,
      "credentials": {
        "googlePalmApi": {
          "id": "QWdaC79EGk4Urrq9",
          "name": "Testn8nrag"
        }
      },
      "notes": "TH√äM NODE M·ªöI: Model cho Gemini Fallback"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "gemini-response",
              "name": "response",
              "type": "string",
              "value": "={{ $json.text }}\n\n---\n‚ö†Ô∏è *L∆∞u √Ω: Th√¥ng tin n√†y ƒë∆∞·ª£c cung c·∫•p t·ª´ ki·∫øn th·ª©c t·ªïng qu√°t c·ªßa AI, ch∆∞a ƒë∆∞·ª£c x√°c th·ª±c trong c∆° s·ªü d·ªØ li·ªáu chuy√™n bi·ªát. Vui l√≤ng tham kh·∫£o b√°c sƒ© ƒë·ªÉ ƒë∆∞·ª£c t∆∞ v·∫•n ch√≠nh x√°c.*"
            },
            {
              "id": "source-type",
              "name": "responseType",
              "type": "string",
              "value": "gemini_fallback"
            },
            {
              "id": "severity-normal",
              "name": "severity",
              "type": "string",
              "value": "normal"
            }
          ]
        },
        "options": {}
      },
      "id": "fea6458c-98a7-4a8d-8b16-f47d3fd5c6b0",
      "name": "Format Gemini Fallback1",
      "type": "n8n-nodes-base.set",
      "position": [
        2960,
        1776
      ],
      "typeVersion": 3.4,
      "notes": "TH√äM NODE M·ªöI: Format response t·ª´ Gemini v·ªõi warning"
    }
  ],
  "pinData": {},
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "Normalize Input",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook (API)": {
      "main": [
        [
          {
            "node": "Normalize Input",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Normalize Input": {
      "main": [
        [
          {
            "node": "AI Agent (RAG)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent (RAG)": {
      "main": [
        [
          {
            "node": "Check AI Success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check AI Success": {
      "main": [
        [
          {
            "node": "Check KB Has Data?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Format Error Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Success Response": {
      "main": [
        [
          {
            "node": "Compile Final Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Error Response": {
      "main": [
        [
          {
            "node": "Compile Final Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Compile Final Response": {
      "main": [
        [
          {
            "node": "Send Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent (RAG)",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Conversation Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent (RAG)",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Knowledge Base Tool": {
      "ai_tool": [
        [
          {
            "node": "AI Agent (RAG)",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Pinecone Vector Store": {
      "ai_vectorStore": [
        [
          {
            "node": "Knowledge Base Tool",
            "type": "ai_vectorStore",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Chat for Embeddings": {
      "ai_languageModel": [
        [
          {
            "node": "Knowledge Base Tool",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Embeddings": {
      "ai_embedding": [
        [
          {
            "node": "Pinecone Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Check KB Has Data?": {
      "main": [
        [
          {
            "node": "Prepare for Gemini",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Format Success Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare for Gemini": {
      "main": [
        [
          {
            "node": "Gemini Fallback Answer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Fallback Answer": {
      "main": [
        [
          {
            "node": "Format Gemini Fallback1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Fallback Model": {
      "ai_languageModel": [
        [
          {
            "node": "Gemini Fallback Answer",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Format Gemini Fallback1": {
      "main": [
        [
          {
            "node": "Compile Final Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "availableInMCP": false
  },
  "versionId": "2fa7b761-41c6-43d3-aa20-881d7f6f1be7",
  "meta": {
    "instanceId": "f19ed9fad5d3fc6c406211e4d1a49eaa90748654f86be14a397378264213be4d"
  },
  "id": "zf3HAoEGzOh2ZVgA",
  "tags": [
    {
      "updatedAt": "2026-01-12T14:17:55.617Z",
      "createdAt": "2026-01-12T14:17:55.617Z",
      "id": "22Hbd2fjgimf3vZz",
      "name": "Health Assistant"
    },
    {
      "updatedAt": "2026-01-12T14:17:55.633Z",
      "createdAt": "2026-01-12T14:17:55.633Z",
      "id": "7vhAF0zNnk9CcjIM",
      "name": "RAG Chatbot"
    },
    {
      "updatedAt": "2026-01-12T14:17:55.626Z",
      "createdAt": "2026-01-12T14:17:55.626Z",
      "id": "fxaZ5XimHLnv1Jmw",
      "name": "Respiratory"
    }
  ]
}